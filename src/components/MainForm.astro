---
import type { HTMLAttributes } from "astro/types";

interface FormField {
    id: string;
    label: string;
    type: HTMLAttributes<"input">["type"];
    placeholder: string;
}

const formFields: FormField[] = [
    {
        id: "fullname",
        label: "Full Name",
        type: "text",
        placeholder: "John Doe",
    },
    {
        id: "email",
        label: "Email Address",
        type: "email",
        placeholder: "john@example.com",
    },
    {
        id: "phone",
        label: "Phone Number",
        type: "tel",
        placeholder: "+1 (555) 000-0000",
    },
    {
        id: "destination",
        label: "Destination",
        type: "text",
        placeholder: "New York",
    },
    {
        id: "nationality",
        label: "Nationality",
        type: "text",
        placeholder: "Enter Nationality",
    },
    {
        id: "current_city",
        label: "Current City",
        type: "text",
        placeholder: "Enter Current City",
    },
];
---

<!-- Booking Form Section (Overlapping Hero) -->
<section class="-mt-24 pb-16 px-4 sm:px-6 lg:px-8 relative z-30">
    <div class="max-w-6xl mx-auto">
        <div
            class="bg-white rounded-none shadow-xl p-6 md:p-10 transform transition-all hover:shadow-2xl"
        >
            <div class="mb-8 text-center md:text-left">
                <h2
                    class="text-2xl font-bold text-brand-blue uppercase tracking-wide"
                >
                    Start Your Journey
                </h2>
                <p class="text-gray-500">
                    Fill in the details below to get a customized travel
                    itinerary.
                </p>
            </div>

            <form
                action="https://api.web3forms.com/submit"
                method="POST"
                class="space-y-6"
            >
                <input
                    type="hidden"
                    name="access_key"
                    value={import.meta.env.PUBLIC_WEB3FORMS_KEY}
                />
                <div
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                >
                    {
                        formFields.map((field) => (
                            <div class="relative group">
                                <label
                                    for={field.id}
                                    class="block text-sm font-medium text-gray-700 mb-1 group-hover:text-brand-blue transition-colors"
                                >
                                    {field.label}
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="ri-user-line text-gray-400 group-focus-within:text-brand-blue transition-colors" />
                                    </div>
                                    <input
                                        type={field.type}
                                        id={field.id}
                                        name={field.id}
                                        class="block w-full pl-10 pr-3 py-3 border border-gray-200 rounded-none focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all bg-gray-50 focus:bg-white"
                                        placeholder={field.placeholder}
                                    />
                                </div>
                            </div>
                        ))
                    }

                    <!-- Submit Button -->
                    <div class="pt-4 col-span-full flex justify-end">
                        <button
                            type="submit"
                            class="w-full md:w-auto bg-brand-yellow text-gray-900 font-bold py-3 px-8 rounded-none shadow-lg hover:bg-yellow-400 hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2"
                        >
                            <span>Get My Free Quote</span>
                            <i class="ri-arrow-right-line"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Success Modal (Main Form) -->
<div
    id="main-success-modal"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm"
>
    <div
        class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 text-center transform transition-all scale-100"
    >
        <div
            class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"
        >
            <i class="ri-checkbox-circle-fill text-4xl text-green-500"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-2">Quote Requested!</h3>
        <p class="text-gray-600 mb-8">
            We have received your request. One of our agents will contact you
            shortly with your customized itinerary.
        </p>
        <button
            id="main-close-modal"
            class="bg-brand-blue text-white font-bold py-3 px-8 rounded-lg hover:bg-brand-yellow hover:text-gray-900 transition-colors w-full"
        >
            Close
        </button>
    </div>
</div>

<script is:inline>
    // IDs are unique per page, but scoped selectors are safer if multiple forms exist
    // However, given the layout, we will use specific IDs for this modal to avoid conflicts
    const mainForm = document.querySelector("section.z-30 form");
    const mainModal = document.getElementById("main-success-modal");
    const mainCloseBtn = document.getElementById("main-close-modal");

    if (mainForm) {
        mainForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(mainForm);
            const submitBtn = mainForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = "<span>Sending...</span>";

            try {
                const response = await fetch(
                    "https://api.web3forms.com/submit",
                    {
                        method: "POST",
                        body: formData,
                    },
                );

                if (response.status === 200) {
                    // Success
                    mainForm.reset();
                    mainModal.classList.remove("hidden");
                    mainModal.classList.add("flex");
                } else {
                    alert("Something went wrong. Please try again.");
                }
            } catch (error) {
                console.error(error);
                alert("Connection error. Please try again.");
            } finally {
                // Reset button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });
    }

    if (mainCloseBtn && mainModal) {
        mainCloseBtn.addEventListener("click", () => {
            mainModal.classList.add("hidden");
            mainModal.classList.remove("flex");
        });

        mainModal.addEventListener("click", (e) => {
            if (e.target === mainModal) {
                mainModal.classList.add("hidden");
                mainModal.classList.remove("flex");
            }
        });
    }
</script>
